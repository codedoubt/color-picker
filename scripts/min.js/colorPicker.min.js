var $=function(t){return"#"==t[0]?document.getElementById(t.slice(1)):"."==t[0]?document.getElementsByClassName(t.slice(1)):document.getElementsByTagName(t)},ColorPicker=function(t){function e(t,e){this.pick.fillStyle="hsl("+(t||0)+",100%,50%)",this.pick.rect(0,0,e.width,e.height),this.pick.fill();var n=this.pick.createLinearGradient(0,0,e.width,0),i=this.pick.createLinearGradient(0,0,0,e.height);n.addColorStop(0,"rgba(255,255,255,1)"),n.addColorStop(1,"rgba(255,255,255,0)"),i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"rgba(0,0,0,1)"),this.pick.fillStyle=n,this.pick.fillRect(0,0,e.width,e.height),this.pick.fillStyle=i,this.pick.fillRect(0,0,e.width,e.height)}this.bound=t.bound,this.boundHandle=t.boundHandle,this.picker=t.picker,this.pickHandle=t.pickHandle,this.slider=t.slider,this.slideHandle=t.slideHandle,this.options=t.options,this.output=t.output,this.onchange=t.onchange||function(){},this.pick=picker.getContext("2d"),this.slide=slider.getContext("2d"),log(this.bound,this.boundHandle,this.picker,this.pickHandle,this.slider,this.slideHandle,this.options,this.output,this.onchange,this.pick,this.slide),log(onchange.toString()),draggable(boundHandle,{attach:!0,attachTo:"#"+this.bound.id}),draggable(pickHandle,{bound:!0,boundTo:"#"+this.picker.id,offLeft:-5,offTop:-5,onmove:u}),draggable(slideHandle,{bound:!0,boundTo:"#"+this.slider.id,dragY:!1,offLeft:-10,offTop:-2,onmove:h}),e(null,picker);for(var n=0;n<=360;n++)this.slide.fillStyle="hsl("+n+",100%,50%)",this.slide.fillRect(n*this.slider.width/360,0,2,20);this.slider.addEventListener("click",function(t){a(360*(t.pageX-bound.offsetLeft-22.5)/slider.width),h(t)}),this.picker.addEventListener("click",function(t){o(t.pageX-bound.offsetLeft-5,t.pageY-bound.offsetTop-boundHandle.offsetHeight-5),u(t)});var i=function(t){e(t,this.picker)},r=function(t,e){var n=this.pick.getImageData(t,e,1,1);return[n.data[0],n.data[1],n.data[2]]};function s(t){this.output.value="",this.output.value=t,onchange(t)}function a(t){var e=Math.round(205*t/360)-10;this.slideHandle.style.left=e+"px"}function o(t,e){this.pickHandle.style.top=e+"px",this.pickHandle.style.left=t+"px"}function h(t){(n=t.pageX-this.bound.offsetLeft-22.5)<0&&(n=0),n>this.slider.width&&(n=this.slider.width),log(),e(Math.round(360*n/this.slider.width),this.picker),o();var n,i=this.pickHandle.offsetTop;c(n=this.pickHandle.offsetLeft,i)}function u(t){c(t.pageX-this.bound.offsetLeft-5,t.pageY-this.bound.offsetTop-this.boundHandle.offsetHeight-5)}function c(t,e){t<0&&(t=0),e<0&&(e=0),t>249.5&&(t=249.5),e>249.5&&(e=249.5);var n=r(t,e),i=n[0],a=n[1],o=n[2],h=options.value;s(w("rgb",h,d(i,a,o)))}function d(t,e,n){return"rgb("+Math.round(t)+", "+Math.round(e)+", "+Math.round(n)+")"}function l(t,e,n){return"hsl("+Math.round(t)+", "+e+"%, "+n+"%)"}function f(t,e,n){return"#"+[t,e,n].map(function(t){var e=t.toString(16);return 1===e.length?"0"+e:e}).join("")}function p(t){return t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,n,i){return"#"+e+e+n+n+i+i}).substring(1).match(/.{2}/g).map(function(t){return parseInt(t,16)})}function g(t,e,n){var i,r,s,a,o,h,u,c=[];for(c[0]=t/255,c[1]=e/255,c[2]=n/255,i=c[0],r=c[0],h=0,s=0;s<c.length-1;s++)c[s+1]<=i&&(i=c[s+1]),c[s+1]>=r&&(r=c[s+1],h=s+1);return 0==h&&(u=(c[1]-c[2])/(r-i)),1==h&&(u=2+(c[2]-c[0])/(r-i)),2==h&&(u=4+(c[0]-c[1])/(r-i)),isNaN(u)&&(u=0),(u*=60)<0&&(u+=360),a=(i+r)/2,o=o=i==r?0:a<.5?(r-i)/(r+i):(r-i)/(2-r-i),[u,Math.round(100*o),Math.round(100*a)]}function b(t,e,n){var i,r,s,a,o;return e/=100,t/=60,s=255*k(i=2*(n/=100)-(r=n<=.5?n*(e+1):n+e-n*e),r,t+2),a=255*k(i,r,t),o=255*k(i,r,t-2),[Math.round(s),Math.round(a),Math.round(o)]}function k(t,e,n){return n<0&&(n+=6),n>=6&&(n-=6),n<1?(e-t)*n+t:n<3?e:n<4?(e-t)*(4-n)+t:t}function v(t){return g(p(t)[0],p(t)[1],p(t)[2])}function x(t,e,n){return f(b(t,e,n)[0],b(t,e,n)[1],b(t,e,n)[2])}function m(t){return"#"==t[0]&&t.split("").map(function(t){return"#012345679ABCDEFabcdef".indexOf(t)>-1}).filter(function(t){}).length<=0&&t.length<=7?"hex":t.indexOf("rgb")>-1?"rgb":t.indexOf("hsl")>-1?"hsl":void 0}function w(t,e,n){var i,r,s,a,o,h;switch(t){case"hex":switch(i=v(n)[0],r=v(n)[1],s=v(n)[2],a=p(n)[0],o=p(n)[1],h=p(n)[2],e){case"hsl":return l(v(n)[0],v(n)[1],v(n)[2]);case"rgb":return d(p(n)[0],p(n)[1],p(n)[2]);case"hex":return n}break;case"rgb":var u=n.match(/[0-9]+[.]?[0-9]?[0-9]?/g).filter(function(t){return""!=t});switch(i=g(a=parseInt(u[0]),o=parseInt(u[1]),h=parseInt(u[2]))[0],r=g(a,o,h)[1],s=g(a,o,h)[2],e){case"rgb":return n;case"hex":return f(a,o,h);case"hsl":return l(i,r,s)}break;case"hsl":u=n.match(/[0-9]+[.]?[0-9]?[0-9]?/g).filter(function(t){return""!=t});switch(a=b(i=parseInt(u[0]),r=parseInt(u[1]),s=parseInt(u[2]))[0],o=b(i,r,s)[1],h=b(i,r,s)[2],e){case"rgb":return d(a,o,h);case"hex":return x(i,r,s);case"hsl":return n}}}function m(t){return"#"==t[0]&&t.split("").map(function(t){return"#012345679ABCDEFabcdef".indexOf(t)>-1}).filter(function(t){}).length<=0&&t.length<=7?"hex":t.indexOf("rgb")>-1?"rgb":t.indexOf("hsl")>-1?"hsl":void 0}function w(t,e,n){var i,r,s,a,o,h;switch(t){case"hex":switch(i=v(n)[0],r=v(n)[1],s=v(n)[2],a=p(n)[0],o=p(n)[1],h=p(n)[2],e){case"hsl":return l(v(n)[0],v(n)[1],v(n)[2]);case"rgb":return d(p(n)[0],p(n)[1],p(n)[2]);case"hex":return n}break;case"rgb":var u=n.match(/[0-9]+[.]?[0-9]?[0-9]?/g).filter(function(t){return""!=t});switch(i=g(a=parseInt(u[0]),o=parseInt(u[1]),h=parseInt(u[2]))[0],r=g(a,o,h)[1],s=g(a,o,h)[2],e){case"rgb":return n;case"hex":return f(a,o,h);case"hsl":return l(i,r,s)}break;case"hsl":u=n.match(/[0-9]+[.]?[0-9]?[0-9]?/g).filter(function(t){return""!=t});switch(a=b(i=parseInt(u[0]),r=parseInt(u[1]),s=parseInt(u[2]))[0],o=b(i,r,s)[1],h=b(i,r,s)[2],e){case"rgb":return d(a,o,h);case"hex":return x(i,r,s);case"hsl":return n}}}options.addEventListener("change",function(){var t=output.value,e=m(t);s(w(e,this.value,t))}),output.addEventListener("keyup",function(){var t=this.value,e=m(t);options.value=t?e:"hex";try{var n=w(e,"hsl",t),r=n.match(/[0-9]+[.]?[0-9]?[0-9]?/g).filter(function(t){return""!=t}),s=r[0],h=r[1],u=r[2];i(s),a(s);var c=h*picker.width/100,d=u*picker.width/100;o(c-5,picker.width-d-5),onchange(t)}catch(t){log("wrong input value")}})};